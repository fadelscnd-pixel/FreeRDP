name: RDP-ZeroTier

on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-latest
    timeout-minutes: 3600

    steps:
      - name: Enable RDP
        run: |
          reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
          reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f
          netsh advfirewall firewall add rule name="RDP" dir=in action=allow protocol=TCP localport=3389
          sc start TermService

      - name: Create RDP User (GUARANTEED)
        run: |
          net user RDP P@ssw0rd123! /add
          net localgroup Administrators RDP /add
          net localgroup "Remote Desktop Users" RDP /add

      - name: Install ZeroTier
        run: |
          curl -L https://download.zerotier.com/dist/ZeroTier%20One.msi -o zt.msi
          msiexec /i zt.msi /quiet /norestart

      - name: Join ZeroTier Network
        run: |
          "C:\Program Files\ZeroTier\One\zerotier-cli.bat" join ${{ secrets.ZEROTIER_NETWORK_ID }}
          timeout /t 20
          "C:\Program Files\ZeroTier\One\zerotier-cli.bat" listnetworks

      - name: Show RDP Info
        run: |
          echo =========================
          echo RDP READY
          echo USER : RDP
          echo PASS : P@ssw0rd123!
          echo =========================

      - name: Keep Runner Alive
        run: |
          timeout /t 3600
